# Gas Town Convoy - Prime Minister Implementation

convoy: prime-minister-implementation
description: Implement Prime Minister mode for autonomous convoy execution

## Meta
created: 2026-01-08T00:00:00Z
updated: 2026-01-08T01:00:00Z
phase: completed
mode: prime
design-doc: docs/plans/2026-01-08-prime-minister-design.md
max-workers: 3

## Planning
- [x] [mayor] Design system architecture
- [x] [mayor] Define communication protocol
- [x] [mayor] Specify PM agent behavior
- [x] [mayor] Define CLI interface
- [x] [mayor] Create implementation plan
- [x] [mayor] Write design document

## Implementation (Phase 1 - Core)
- [x] [polecat] Create PM agent definition (.gastown/agents/prime.md)
- [x] [polecat] Add --prime/-p CLI flag to gastown.ts
- [x] [polecat] Update types.ts with prime mode types
- [x] [polecat] Add launchPrime to claude/launcher.ts
- [x] [polecat] Update commands.ts for prime mode startup
- [x] [polecat] Add PM-specific prompt builder to command.ts
- [x] [polecat] Update mayor.md for PM-aware behavior

## Implementation (Phase 2 - Character & UX)
- [x] [polecat] Add ASCII art character for Prime Minister
- [x] [polecat] Add ASCII art character for Mayor
- [x] [polecat] Add greeting/introduction for PM on startup
- [x] [polecat] Add mode-specific visual frames for Mayor

## Implementation (Phase 3 - Autonomous Operation)
- [x] [polecat] Document focus-independent operation
- [x] [polecat] Add --dangerously-skip-permissions flag support
- [x] [polecat] Enable auto-skip permissions for PM role
- [x] [polecat] Add Permission Proxy feature (auto-approve Mayor tools)

## Testing
- [x] [dog] Unit tests for PM prompt builder
- [x] [dog] Integration test for pane capture
- [x] [dog] Manual test: prime mode startup

## Review
- [x] [witness] Code review all changes
- [x] [witness] Spec compliance review
- [x] [witness] Code quality review

## Commits
1. `feat(agents): add Prime Minister agent definition`
2. `feat(cli): add --prime flag for Prime Minister mode`
3. `feat(launcher): add launchPrime for PM pane creation`
4. `feat(command): add PM-aware prompts for Mayor and Prime`
5. `feat(commands): integrate PM mode into convoy startup and resume`
6. `feat(mayor): add Prime Minister mode awareness`
7. `test(prime): add PM prompt builder tests`
8. `docs(agents): add character art and greetings for PM and Mayor`
9. `docs(prime): add focus-independent operation guidance`
10. `feat(prime): add --dangerously-skip-permissions for autonomous operation`
11. `feat(prime): add permission proxy to auto-approve Mayor's tool usage`

## Architecture Summary

### PM Mode Flow
```
gastown --prime "task"
    │
    ├── Launch Mayor (pane 0)
    │   └── PM-aware prompt (questions to bd file)
    │
    └── Launch PM (pane 1, split)
        ├── --dangerously-skip-permissions
        ├── Monitor Mayor's pane (capture-pane)
        ├── Auto-approve permissions (send-keys)
        ├── Read questions from bd file
        ├── Answer from context or inference
        └── Escalate to human when uncertain
```

### Key Features
1. **bd File Communication**: Mayor writes questions, PM writes answers
2. **Focus-Independent**: All operations work regardless of tmux pane focus
3. **Permission Proxy**: PM auto-approves Mayor's tool usage
4. **Confidence Levels**: high (context), medium (inferred), low/none (escalate)
5. **Decision Log**: All decisions tracked in bd file

### Files Modified
- `.gastown/agents/prime.md` - PM agent definition
- `.gastown/agents/mayor.md` - PM-aware behavior
- `src/claude/command.ts` - PM prompt builder + dangerouslySkipPermissions
- `src/claude/launcher.ts` - launchPrime function
- `src/cli/commands.ts` - PM mode startup
- `src/types.ts` - RoleName includes 'prime'
- `gastown.ts` - --prime CLI flag

## Notes
last-checkpoint: implementation-complete
context-usage: 85%
next-steps: Manual testing with real convoy, iterate on PM behavior
