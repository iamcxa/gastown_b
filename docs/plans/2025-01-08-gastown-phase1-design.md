# Gastown Phase 1 Design: æœ¬åœ°æ“ä½œå¼·åŒ–

> è¨­è¨ˆæ—¥æœŸï¼š2025-01-08
> ç‹€æ…‹ï¼šå·²ç¢ºèªï¼Œå¾…å¯¦ä½œ

## ç›®æ¨™

å¼·åŒ– gastown çš„æœ¬åœ°æ“ä½œé«”é©—ï¼Œç‚ºæœªä¾†é›²ç«¯åŸ·è¡Œæ‰“ä¸‹åŸºç¤ã€‚

### æ ¸å¿ƒéœ€æ±‚

1. **é›²ç«¯åŸ·è¡Œ**ï¼ˆç¬¬äºŒéšæ®µï¼‰- æ¶æ§‹éœ€æ”¯æ´æœªä¾†é›²ç«¯éƒ¨ç½²
2. **æ‰‹æ©Ÿäº’å‹•**ï¼ˆç¬¬äºŒéšæ®µï¼‰- PM è§’è‰²å¯é€éæ‰‹æ©Ÿäº’å‹•
3. **ä¸éœ€å¤§é‡è¨­å®š** - ç›´æ¥ä½¿ç”¨ `.claude/` ç¾æœ‰è¨­å®š
4. **Superpowers æ•´åˆ** - é€é workflow ç”¢ç”Ÿé«˜å“è³ªè¼¸å‡º

## æ¶æ§‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç¬¬ä¸€éšæ®µï¼šæœ¬åœ°æ“ä½œ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   mprocs (å¯é¸ dashboard)                                       â”‚
â”‚   â””â”€â”€ é¡¯ç¤ºæ‰€æœ‰ rigs ç‹€æ…‹                                        â”‚
â”‚       â””â”€â”€ é—œé–‰ mprocs æ™‚ï¼Œtmux ç¹¼çºŒå­˜æ´»                          â”‚
â”‚                                                                 â”‚
â”‚   tmux sessions (ç¨ç«‹å­˜æ´»)                                       â”‚
â”‚   â””â”€â”€ gastown-{convoy-id}                                       â”‚
â”‚       â”œâ”€â”€ å¢å¼· status barï¼ˆè§’è‰²ã€context%ã€ä»»å‹™ï¼‰                â”‚
â”‚       â””â”€â”€ æ¯å€‹ pane æ¨™ç¤ºè§’è‰² icon                                â”‚
â”‚                                                                 â”‚
â”‚   GUPP (Claude hooks è§¸ç™¼)                                      â”‚
â”‚   â””â”€â”€ PostToolUse â†’ beads è®Šæ›´ â†’ è‡ªå‹• spawn workers             â”‚
â”‚                                                                 â”‚
â”‚   Context ä¾†æº                                                  â”‚
â”‚   â””â”€â”€ ç›´æ¥è®€å– .claude/ è¨­å®šï¼ˆCLAUDE.md, settings.jsonï¼‰        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç¬¬äºŒéšæ®µé è¦½ï¼ˆé›²ç«¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç¬¬äºŒéšæ®µï¼šé›²ç«¯åŸ·è¡Œ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ğŸ“± æ‰‹æ©Ÿ App â—„â”€â”€â”€â”€ WebSocket â”€â”€â”€â”€â–º ğŸ›ï¸ PM (é•·é§å®¹å™¨)            â”‚
â”‚                                          â”‚                      â”‚
â”‚                                          â”‚ äº‹ä»¶è§¸ç™¼              â”‚
â”‚                                          â–¼                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              âš¡ Serverless Workers                       â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚   â”‚  â”‚ polecat â”‚ â”‚ witness â”‚ â”‚   dog   â”‚ â”‚refinery â”‚       â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## çµ„ä»¶è¨­è¨ˆ

### 1. tmux å¢å¼·

**ç¾ç‹€å•é¡Œï¼š**
- ä¸çŸ¥é“ç•¶å‰æ˜¯å“ªå€‹è§’è‰²
- ä¸çŸ¥é“ context ä½¿ç”¨ç‡
- ä¸çŸ¥é“ç•¶å‰ä»»å‹™

**å¢å¼·å¾Œï¼š**

```
â”Œâ”€ gastown-convoy-abc123 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ–ï¸ MAYOR â”‚ ctx: 45% â”‚ task: å”èª¿ chess-game é–‹ç™¼            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [Agent è¼¸å‡ºå…§å®¹]                                            â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ agents: [ğŸ–ï¸ mayor] [ğŸ“ planner] [âš¡ polecat-1]              â”‚
â”‚ C-b n: next pane â”‚ C-b s: session list â”‚ C-b d: detach     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¯¦ç¾æ–¹å¼ï¼š**
- å•Ÿå‹•æ™‚è¨­å®š tmux status bar
- å®šæœŸæ›´æ–° context ä½¿ç”¨ç‡åˆ°ç’°å¢ƒè®Šæ•¸
- æ¯å€‹ pane æ¨™ç¤ºè§’è‰² icon

### 2. mprocs Dashboard

**å•Ÿå‹•æ–¹å¼ï¼š**
```bash
$ gastown dashboard
```

**UI è¨­è¨ˆï¼š**

```
â”Œâ”€ gastown dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  RIGS                          AGENTS                       â”‚
â”‚  â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€                       â”‚
â”‚  â— chess-game (3 agents)       ğŸ–ï¸ mayor    [working] 45%   â”‚
â”‚  â—‹ auth-api (idle)             ğŸ“ planner  [done]          â”‚
â”‚  â—‹ docs (idle)                 âš¡ polecat-1 [working] 23%   â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SELECTED: chess-game                                       â”‚
â”‚  Task: å¯¦ä½œè¥¿æ´‹æ£‹éŠæˆ²                                        â”‚
â”‚  Status: in_progress (2/5 tasks done)                       â”‚
â”‚                                                             â”‚
â”‚  Recent:                                                    â”‚
â”‚  > [mayor] Delegating to polecat for GameState impl...      â”‚
â”‚  > [polecat-1] Starting TDD cycle for Piece class...        â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [a]ttach  [s]top  [r]esume  [l]ogs  [q]uit                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å±•é–‹/æ”¶èµ·åŠŸèƒ½ï¼š**
- æŒ‰ `[e]` å±•é–‹è©³ç´°ï¼ˆcontext%ã€taskã€skillã€last outputã€uptimeï¼‰
- æŒ‰ `[c]` æ”¶èµ·å›ç°¡æ½”æ¨¡å¼

**é—œéµè¨­è¨ˆï¼š**
- mprocs åªæ˜¯ UIï¼Œé—œé–‰å¾Œ tmux ç¹¼çºŒå­˜æ´»
- tmux sessions ç”± `gastown start` ç¨ç«‹å‰µå»º
- mprocs ä½¿ç”¨ `tmux attach` æ–¹å¼é€£æ¥

### 3. GUPP via Claude Hooks

**æ ¸å¿ƒåŸå‰‡ï¼š** "If there is work on your hook, YOU MUST RUN IT"

**Hook è¨­è¨ˆï¼š**

```yaml
# .claude/hooks/gupp.yaml
hooks:
  - event: PostToolUse
    matcher:
      tool: mcp__beads__create
    command: "$GASTOWN_BIN gupp check --trigger=create"

  - event: PostToolUse
    matcher:
      tool: mcp__beads__update
    command: "$GASTOWN_BIN gupp check --trigger=update"

  - event: PostToolUse
    matcher:
      tool: mcp__beads__close
    command: "$GASTOWN_BIN gupp check --trigger=close"
```

**GUPP Check é‚è¼¯ï¼š**

```
gastown gupp check
    â”‚
    â”œâ”€â–º æƒæ beads hooksï¼ˆæ¯å€‹ agent çš„å¾…è¾¦å·¥ä½œï¼‰
    â”‚
    â”œâ”€â–º ç™¼ç¾ ready tasksï¼Ÿ
    â”‚   â”œâ”€â–º YES: æ‰¾åˆ°ç©ºé–’çš„ worker slot â†’ spawn worker
    â”‚   â””â”€â–º NO: ç„¡å‹•ä½œ
    â”‚
    â””â”€â–º ç™¼ç¾æ‰€æœ‰ä»»å‹™å®Œæˆï¼Ÿ
        â””â”€â–º YES: é€šçŸ¥ mayor è§¸ç™¼ finishing-a-development-branch
```

### 4. Superpowers å¼·åˆ¶ç¶å®š

**è§’è‰² â†’ Skill æ˜ å°„ï¼š**

| è§’è‰² | Skill(s) | é¡å‹ |
|------|----------|------|
| mayor | `dispatching-parallel-agents`, `finishing-a-development-branch` | skill-tool |
| planner | `brainstorming`, `writing-plans` | slash-command |
| foreman | `subagent-driven-development` | skill-tool |
| polecat | `executing-plans`, `receiving-code-review`* | slash-command / skill-tool |
| witness | `requesting-code-review` | skill-tool |
| dog | `test-driven-development`, `verification-before-completion` | skill-tool |
| refinery | `systematic-debugging` | skill-tool |
| prime | - | - |

*polecat çš„ `receiving-code-review` åœ¨æ”¶åˆ° witness å›é¥‹å¾Œè§¸ç™¼

**èª¿ç”¨æ–¹å¼å€åˆ†ï¼š**

- **Slash Command**ï¼ˆ`brainstorming`, `writing-plans`, `executing-plans`ï¼‰
  ```
  FIRST ACTION: Execute /superpowers:brainstorming and follow its workflow completely.
  ```

- **Skill Tool**ï¼ˆå…¶ä»– skillsï¼‰
  ```
  You MUST use the Skill tool to invoke "superpowers:skill-name" when applicable.
  ```

## å¯¦ä½œè¨ˆåŠƒ

### éœ€è¦æ–°å¢/ä¿®æ”¹çš„æª”æ¡ˆ

```
src/
â”œâ”€â”€ cli/
â”‚   â”œâ”€â”€ commands.ts      # ä¿®æ”¹ï¼šåŠ å…¥ dashboard, gupp æŒ‡ä»¤
â”‚   â””â”€â”€ dashboard.ts     # æ–°å¢ï¼šmprocs æ•´åˆ
â”œâ”€â”€ claude/
â”‚   â”œâ”€â”€ command.ts       # ä¿®æ”¹ï¼šskill æ³¨å…¥é‚è¼¯
â”‚   â””â”€â”€ skills.ts        # æ–°å¢ï¼šROLE_SKILLS æ˜ å°„
â”œâ”€â”€ tmux/
â”‚   â””â”€â”€ status.ts        # æ–°å¢ï¼šstatus bar è¨­å®š
â”œâ”€â”€ gupp/
â”‚   â”œâ”€â”€ check.ts         # æ–°å¢ï¼šGUPP æª¢æŸ¥é‚è¼¯
â”‚   â””â”€â”€ trigger.ts       # æ–°å¢ï¼šworker è§¸ç™¼é‚è¼¯

.claude/
â””â”€â”€ hooks/
    â””â”€â”€ gupp.yaml        # æ–°å¢ï¼šGUPP hooks

.gastown/
â”œâ”€â”€ agents/*.md          # ä¿®æ”¹ï¼šåŠ å…¥ skill æŒ‡ä»¤
â””â”€â”€ dashboard.mprocs.yaml # æ–°å¢ï¼šmprocs è¨­å®šæ¨¡æ¿
```

### ä»»å‹™æ‹†è§£

1. **tmux å¢å¼·**
   - [ ] å¯¦ä½œ status bar è¨­å®šå‡½æ•¸
   - [ ] å¯¦ä½œ context ä½¿ç”¨ç‡æ›´æ–°æ©Ÿåˆ¶
   - [ ] æ›´æ–° agent å•Ÿå‹•æµç¨‹åŠ å…¥ status bar

2. **mprocs Dashboard**
   - [ ] å¯¦ä½œ `gastown dashboard` æŒ‡ä»¤
   - [ ] å¯¦ä½œ mprocs.yaml å‹•æ…‹ç”Ÿæˆ
   - [ ] å¯¦ä½œç‹€æ…‹æŸ¥è©¢ API

3. **GUPP**
   - [ ] å¯¦ä½œ `gastown gupp check` æŒ‡ä»¤
   - [ ] å‰µå»º `.claude/hooks/gupp.yaml`
   - [ ] å¯¦ä½œ worker spawn è§¸ç™¼é‚è¼¯

4. **Superpowers ç¶å®š**
   - [ ] å‰µå»º `src/claude/skills.ts` å®šç¾©æ˜ å°„
   - [ ] ä¿®æ”¹ `buildRolePrompt` æ³¨å…¥ skill æŒ‡ä»¤
   - [ ] æ›´æ–°æ‰€æœ‰ agent.md æ–‡ä»¶

## èˆ‡ Yegge åŸç‰ˆæ¯”è¼ƒ

| Yegge åŠŸèƒ½ | æˆ‘å€‘çš„ç‹€æ…‹ | èªªæ˜ |
|------------|-----------|------|
| Hooks & Molecules | éƒ¨åˆ†å¯¦ç¾ | ç”¨ GUPP + beads æ›¿ä»£ |
| Seance | æœªå¯¦ç¾ | å¯ç”¨ `/resume` æ›¿ä»£ |
| Wisps | æœªå¯¦ç¾ | ä½å„ªå…ˆ |
| Deacon Patrol | æœªå¯¦ç¾ | ç¬¬äºŒéšæ®µ |
| Towns vs Rigs | æœªå¯¦ç¾ | ç›®å‰å–® rig å¤ ç”¨ |
| gt sling | æœªå¯¦ç¾ | ç”¨ `gastown spawn` æ›¿ä»£ |

## åƒè€ƒè³‡æ–™

- [Welcome to Gas Town - Steve Yegge](https://steve-yegge.medium.com/welcome-to-gas-town-4f25ee16dd04)
- [Hacker News Discussion](https://news.ycombinator.com/item?id=46458936)
